<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Grapesjs Test</title>
    <meta content="Best Free Open Source Responsive No-Code Newsletter HTML Email Builder" name="description">
    <link rel="stylesheet" href="grapesjs/grapes.min.css">
    <link rel="stylesheet" href="css/material.css">
    <link rel="stylesheet" href="css/tooltip.css">
    <link rel="stylesheet" href="css/demo.css">

    <script src="grapesjs/grapes.min.js"></script>
    <!-- <script src="./js/ckeditor/ckeditor.js"></script> -->
    <!-- <script src="https://unpkg.com/grapesjs-plugin-ckeditor@0.0.10"></script> -->
    <script src="js/grapesjs-plugin-ckeditor/index.js"></script>
    <script src="js/grapesjs-preset-newsletter@1.0.2.js"></script>
    <script src="js/grapesjs-blocks-basic@1.0.2.js"></script>
<!--    <script src="grapesjs/locale/ko.js" type="module"></script>-->
</head>
<style>
    .nl-link {
        color: inherit;
    }

    .gjs-logo-version {
        background-color: #5a606d;
    }
    .cke_toolbar.cke_toolbar {
        min-height: 33px;
    }

    /* The Modal (background) */
    .modal-test-gjs {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

</style>
<body>

<a href="#" id="open-btn" data-target="gjs"> Open Modal </a>

<div id="modal-test-gjs" class="modal-test-gjs">
    <div style="width: 70%;">

        <div id="gjs" class="gjs-modal" style="height:0px; overflow:hidden;"></div>
        <button id="save-btn">register</button>

    </div>
</div>

<!--<form id="test-form" class="test-form" action="//grapes.16mb.com/s" method="POST">-->
<!--    <div class="putsmail-c">-->
<!--        <a href="https://putsmail.com/" target="_blank">-->
<!--            <img src="./img/putsmail.png" style="opacity:0.85;" />-->
<!--        </a>-->
<!--        <div class="gjs-sm-property" style="font-size: 10px">-->
<!--            Test delivering offered by <a class="nl-link" href="https://litmus.com/" target="_blank">Litmus</a> with <a class="nl-link" href="https://putsmail.com/" target="_blank">Putsmail</a>-->
<!--            <span class="form-status" style="opacity: 0">-->
<!--            <i class="fa fa-refresh anim-spin" aria-hidden="true"></i>-->
<!--          </span>-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class="gjs-sm-property">-->
<!--        <div class="gjs-field">-->
<!--        	<span id="gjs-sm-input-holder">-->
<!--            <input type="email" name="email" placeholder="Email" required>-->
<!--          </span>-->
<!--        </div>-->
<!--    </div>-->

<!--    &lt;!&ndash;    <div class="gjs-sm-property">&ndash;&gt;-->
<!--    &lt;!&ndash;        <div class="gjs-field">&ndash;&gt;-->
<!--    &lt;!&ndash;        	<span id="gjs-sm-input-holder">&ndash;&gt;-->
<!--    &lt;!&ndash;            <input type="text" name="subject" placeholder="Subject" required>&ndash;&gt;-->
<!--    &lt;!&ndash;          </span>&ndash;&gt;-->
<!--    &lt;!&ndash;        </div>&ndash;&gt;-->
<!--    &lt;!&ndash;    </div>&ndash;&gt;-->
<!--    <input type="hidden" name="body">-->
<!--    <button class="gjs-btn-prim gjs-btn-import" style="width: 100%">SEND</button>-->
<!--</form>-->

<div id="info-panel" style="display:none">
    <br/>
    <svg class="info-panel-logo" xmlns="//www.w3.org/2000/svg" version="1"><g id="gjs-logo"><path d="M40 5l-12.9 7.4 -12.9 7.4c-1.4 0.8-2.7 2.3-3.7 3.9 -0.9 1.6-1.5 3.5-1.5 5.1v14.9 14.9c0 1.7 0.6 3.5 1.5 5.1 0.9 1.6 2.2 3.1 3.7 3.9l12.9 7.4 12.9 7.4c1.4 0.8 3.3 1.2 5.2 1.2 1.9 0 3.8-0.4 5.2-1.2l12.9-7.4 12.9-7.4c1.4-0.8 2.7-2.2 3.7-3.9 0.9-1.6 1.5-3.5 1.5-5.1v-14.9 -12.7c0-4.6-3.8-6-6.8-4.2l-28 16.2" style="fill:none;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-width:10;stroke:#fff"/></g></svg>
    <br/>
    <div class="info-panel-label">
        <b>GrapesJS Newsletter Builder</b> is a showcase of what/how is possible to build an editor using the
        <a class="info-panel-link gjs-four-color" target="_blank" href="https://grapesjs.com/">GrapesJS</a>
        core library
        <br/><br/>
        For any tip about this demo (or newsletters construction in general) check the
        <a class="info-panel-link gjs-four-color" target="_blank" href="https://github.com/grapesjs/preset-newsletter">Newsletter Preset repository</a>
        and open an issue. For any problem with the builder itself, open an issue on the main
        <a class="info-panel-link gjs-four-color" target="_blank" href="https://github.com/grapesjs/grapesjs">GrapesJS repository</a>
        <br/><br/>
        Being a free and open source project contributors and supporters are extremely welcome.
        If you like the project support it with a donation of your choice or become a backer/sponsor via
        <a class="info-panel-link gjs-four-color" target="_blank" href="https://opencollective.com/grapesjs">Open Collective</a>
    </div>
</div>

<!--<div style="display: none">-->
<!--    <div class="gjs-logo-cont">-->
<!--        <a href="//grapesjs.com"><img class="gjs-logo" src="img/grapesjs-logo-cl.png"></a>-->
<!--        <div class="gjs-logo-version"></div>-->
<!--    </div>-->
<!--</div>-->


<!--<div class="ad-cont">-->
<!--    <div id="native-carbon"></div>-->
<!--    <script async type="text/javascript" src="./js/carbon-v2.js"></script>-->
<!--    <button id="save-btn"> save </button>-->
<!--</div>-->


<script type="module">
    import * as ko from '/grapesjs/locale/ko.js';

    var host = 'https://grapesjs.com/';

    const storageUrl = `http://localhost:8080/projects/`;

    // Set up GrapesJS editor with the Newsletter plugin
    var editor = grapesjs.init({
        i18n: {
            locale: 'ko',
            localeFallback: 'ko',
            messages:
                {
                    ko: ko.default
                }
            // detectLocale: true,
        },
        selectorManager: { componentFirst: true },
        clearOnRender: true,
        // height: '100%',
        storageManager: {
            type: 'remote',
            urlStore: storageUrl,
            contentTypeJson: true,
            headers: {
                'Content-Type': 'application/json'
            }
            // options: {
                // local: { key: `gjsProjectNl-${projectId}` },
                // remote: {
                //     headers: {
                //       'Content-Type' : 'application/json'
                //     },
                //     contentTypeJson: true,
                //     urlLoad: storageUrl,
                //     urlStore: storageUrl,
                //
                // },
            // }
        },
        blockManager: {
            blocks: [
                {
                    id: 'Test', // id is mandatory
                    label: '<b>Input</b>', // You can use HTML/SVG inside labels
                    attributes: { class:'test-input' },
                    content: `<input type="text">`,
                },
                // {
                //     id: 'text',
                //     label: 'Text',
                //     content: '<div data-gjs-type="text">Insert your text here</div>',
                // }, {
                //     id: 'image',
                //     label: 'Image',
                //     // Select the component once it's dropped
                //     select: true,
                //     // You can pass components as a JSON instead of a simple HTML string,
                //     // in this case we also use a defined component type `image`
                //     content: { type: 'image' },
                //     // This triggers `active` event on dropped components and the `image`
                //     // reacts by opening the AssetManager
                //     activate: true,
                // }
            ]
        },
        assetManager: {
            assets: [
                host + 'img/grapesjs-logo.png',
                host + 'img/tmp-blocks.jpg',
                host + 'img/tmp-tgl-images.jpg',
                host + 'img/tmp-send-test.jpg',
                host + 'img/tmp-devices.jpg',
            ],
            upload: false,
            uploadText: 'Uploading is not available in this demo',
        },
        container : '#gjs',
        fromElement: true,
        plugins: ['grapesjs-preset-newsletter', 'grapesjs-plugin-ckeditor'],
        pluginsOpts: {
            'grapesjs-preset-newsletter': {
                modalLabelImport: 'Paste all your code here below and click import',
                modalLabelExport: 'Copy the code and use it wherever you want',
                codeViewerTheme: 'material',
                importPlaceholder: '<table class="table"><tr><td class="cell">Hello world!</td></tr></table>',
                cellStyle: {
                    'font-size': '12px',
                    'font-weight': 300,
                    'vertical-align': 'top',
                    color: 'rgb(111, 119, 125)',
                    margin: 0,
                    padding: 0,
                },
                blocks: [
                    'sect100', 'sect50', 'sect30', 'sect37',
                    'button', 'divider', 'text', 'text-sect',
                    'image', 'quote', 'link', 'link-block',
                    'grid-items', 'list-items'
                ],
            },
            'grapesjs-plugin-ckeditor': {
                onToolbar: el => {
                    el.style.minWidth = '350px';
                },
                options: {
                    startupFocus: true,
                    extraAllowedContent: '*(*);*{*}', // Allows any class and any inline style
                    allowedContent: true, // Disable auto-formatting, class removing, etc.
                    enterMode: 2, // CKEDITOR.ENTER_BR,
                    extraPlugins: 'sharedspace,justify,colorbutton,panelbutton,font',
                    toolbar: [
                        { name: 'styles', items: ['Font', 'FontSize' ] },
                        ['Bold', 'Italic', 'Underline', 'Strike'],
                        {name: 'paragraph', items : [ 'NumberedList', 'BulletedList']},
                        {name: 'links', items: ['Link', 'Unlink']},
                        {name: 'colors', items: [ 'TextColor', 'BGColor' ]},
                    ],
                }
            },
        }
    });


    // Let's add in this demo the possibility to test our newsletters
    var pnm = editor.Panels;
    var cmdm = editor.Commands;
    var md = editor.Modal;

    // Add info command
    var infoContainer = document.getElementById("info-panel");
    cmdm.add('open-info', {
        run: function(editor, sender) {
            var mdlClass = 'gjs-mdl-dialog-sm';
            sender.set('active', 0);
            var mdlDialog = document.querySelector('.gjs-mdl-dialog');
            mdlDialog.className += ' ' + mdlClass;
            infoContainer.style.display = 'block';
            md.open({
                title: 'About this demo',
                content: infoContainer,
            });
            md.getModel().once('change:open', function() {
                mdlDialog.className = mdlDialog.className.replace(mdlClass, '');
            })
        }
    });

    // Add info button
    const iconStyle = 'style="display: block; max-width: 22px"';
    pnm.addButton('options', [{
        id: 'view-info',
        label: `<svg ${iconStyle} viewBox="0 0 24 24">
            <path fill="currentColor" d="M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z" />
        </svg>`,
        command: 'open-info',
        attributes: {
            'title': 'About',
            'data-tooltip-pos': 'bottom',
        },
    }]);

    // Beautify tooltips
    [
        ['sw-visibility', 'Show Borders'],
        ['preview', 'Preview'],
        ['fullscreen', 'Fullscreen'],
        ['export-template', 'Export'],
        ['undo', 'Undo'],
        ['redo', 'Redo'],
        ['gjs-open-import-template', 'Import'],
        ['gjs-toggle-images', 'Toggle images'],
        ['canvas-clear', 'Clear canvas']
    ].forEach(function(item) {
        pnm.getButton('options', item[0]).set('attributes', {title: item[1], 'data-tooltip-pos': 'bottom'});
    });
    // [
    //   ['open-sm', 'Style Manager'],
    //   ['open-layers', 'Layers'],
    //   ['open-blocks', 'Blocks']
    // ].forEach(function(item) {
    //   pnm.getButton('views', item[0]).set('attributes', { title: item[1], 'data-tooltip-pos': 'bottom', title2: item[1] });
    //   console.log('views', item[0], pnm.getButton('views', item[0]).get('attributes'))
    // });

    var titles = document.querySelectorAll('*[title]');
    for (var i = 0; i < titles.length; i++) {
        var el = titles[i];
        var title = el.getAttribute('title');
        title = title ? title.trim(): '';
        if(!title)
            break;
        el.setAttribute('data-tooltip', title);
        el.setAttribute('title', '');
    }

    // Update canvas-clear command
    cmdm.add('canvas-clear', function() {
        if(confirm('Are you sure to clean the canvas?')) {
            editor.runCommand('core:canvas-clear')
            setTimeout(function(){ localStorage.clear()}, 0)
        }
    });

    // Do stuff on load
    editor.onReady(function() {
        // Show borders by default
        pnm.getButton('options', 'sw-visibility').set('active', 1);

        // Show logo with the version
        var logoCont = document.querySelector('.gjs-logo-cont');
        document.querySelector('.gjs-logo-version').innerHTML = 'v' + grapesjs.version;
        var logoPanel = document.querySelector('.gjs-pn-commands');
        logoPanel.appendChild(logoCont);

        // Wait for CKEDITOR load
        setTimeout(() => {
            if (CKEDITOR) {
                CKEDITOR.dtd.$editable.a = 1;
            }
        }, 200);
    });

    const save = function () {
        var htmlContent = new Array(editor.runCommand('gjs-get-inlined-html'));
        var bl = new Blob(htmlContent, { type: 'text/html' });
        var a = document.createElement('a');
        a.href = URL.createObjectURL(bl);
        a.download = 'test-document';
        a.hidden = true;
        document.body.appendChild(a);
        a.click();
        }

    document.getElementById('save-btn').addEventListener('click', () => {
    //     // editor.store();
    //     let htmlContent = editor.getHtml();
    //     let cssContent = editor.getCss();
        let cssInline = editor.runCommand('gjs-get-inlined-html');
        let projectData = editor.getProjectData();
    //
    //     console.log('html: ', htmlContent);
    //     console.log('css: ', cssContent);
        console.log('cssInline: ', cssInline);
        console.log('projectData: ', projectData);
        save();
    });

    document.getElementById('open-btn').onclick = function () {
        document.getElementById('modal-test-gjs').style.display = "block";
    }

    window.onclick = function(event) {
        if (event.target == document.getElementById('modal-test-gjs')) {
            document.getElementById('modal-test-gjs').style.display = "none";
        }
    }

</script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-74284223-1', 'auto');
    ga('send', 'pageview');
</script>
</body>
</html>